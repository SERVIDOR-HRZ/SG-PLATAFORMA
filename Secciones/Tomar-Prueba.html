<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tomar Prueba - Seamos Genios</title>

    <!-- Security headers -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="../Elementos/css/panel.css">
    <link rel="stylesheet" href="../Elementos/css/tomar-prueba.css">
    <link rel="shortcut icon" href="../Elementos/img/logo1.png" type="image/x-icon">

    <!-- MathJax for full LaTeX support -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true,
                tags: 'ams'
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>

</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <button class="back-btn" id="backBtn" style="display: none;">
                <i class="bi bi-arrow-left"></i>
                Volver
            </button>
            <img src="../Elementos/img/logo1.png" alt="Seamos Genios Logo" class="header-logo">
            <h1 id="pageTitle">Prueba</h1>
        </div>
        <div class="header-right">
            <!-- Music Player Controls -->
            <div class="music-player-header" id="musicPlayerHeader">
                <div class="music-controls-compact">
                    <button class="music-btn-compact" id="prevTrackBtn" title="Canción anterior">
                        <i class="bi bi-skip-backward-fill"></i>
                    </button>
                    <button class="music-btn-compact play-pause-btn-compact" id="playPauseBtn" title="Reproducir/Pausar">
                        <i class="bi bi-play-fill"></i>
                    </button>
                    <button class="music-btn-compact" id="nextTrackBtn" title="Siguiente canción">
                        <i class="bi bi-skip-forward-fill"></i>
                    </button>
                    <button class="music-btn-compact volume-btn-compact" id="volumeBtn" title="Silenciar/Activar sonido">
                        <i class="bi bi-volume-up-fill"></i>
                    </button>
                </div>
                <div class="track-info-compact">
                    <span class="track-title-compact" id="trackTitle">Música Instrumental</span>
                    <div class="volume-control-compact" id="volumeControl">
                        <input type="range" id="volumeSlider" min="0" max="100" value="50" class="volume-slider-compact">
                    </div>
                </div>
            </div>
            <div class="test-timer" id="testTimer">
                <i class="bi bi-clock"></i>
                <span id="timerDisplay">00:00:00</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Test Info -->
        <div class="test-info-card" id="testInfoCard">
            <div class="test-info-header">
                <h2 id="testName">Cargando prueba...</h2>
                <div class="test-status">
                    <span class="current-block" id="currentBlock">Bloque 1</span>
                    <span class="block-time" id="blockTime">08:00 - 10:00</span>
                </div>
            </div>
            <div class="test-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <span class="progress-text" id="progressText">0 de 0 preguntas completadas</span>
            </div>
        </div>

        <!-- Subject Navigation -->
        <div class="subjects-nav" id="subjectsNav">
            <!-- Subject buttons will be loaded here -->
        </div>

        <!-- Question Container -->
        <div class="question-container" id="questionContainer">
            <div class="loading-state">
                <div class="loading-spinner"></div>
                <p>Cargando prueba...</p>
            </div>
        </div>



        <!-- Navigation Controls -->
        <div class="question-controls" id="questionControls" style="display: none;">
            <button class="btn btn-secondary" id="prevBtn" disabled>
                <i class="bi bi-arrow-left"></i>
                Anterior
            </button>
            <div class="question-info">
                <span id="questionNumber">1</span> de <span id="totalQuestions">0</span>
            </div>
            <button class="btn btn-primary" id="nextBtn">
                Siguiente
                <i class="bi bi-arrow-right"></i>
            </button>
        </div>

        <!-- Submit Test -->
        <div class="submit-container" id="submitContainer" style="display: none;">
            <button class="btn btn-success btn-lg" id="submitTestBtn">
                <i class="bi bi-check-circle"></i>
                Finalizar Prueba
            </button>
        </div>
    </main>

    <!-- Block Change Modal -->
    <div class="modal-overlay" id="blockChangeModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Cambio de Bloque</h3>
            </div>
            <div class="modal-body">
                <div class="block-change-info">
                    <i class="bi bi-clock-history"></i>
                    <h4>Es hora del siguiente bloque</h4>
                    <p>El Bloque 1 ha terminado. Ahora comenzará el Bloque 2.</p>
                    <div class="next-block-info">
                        <strong>Bloque 2:</strong> <span id="nextBlockTime">10:30 - 12:30</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="continueToBlock2">
                    <i class="bi bi-play-circle"></i>
                    Continuar al Bloque 2
                </button>
            </div>
        </div>
    </div>

    <!-- Submit Confirmation Modal -->
    <div class="modal-overlay" id="submitModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Confirmar Envío</h3>
            </div>
            <div class="modal-body">
                <div class="submit-confirmation">
                    <i class="bi bi-exclamation-triangle"></i>
                    <h4>¿Estás seguro de que deseas finalizar la prueba?</h4>
                    <p>Una vez enviada, no podrás hacer cambios a tus respuestas.</p>
                    <div class="answers-summary" id="answersSummary">
                        <!-- Summary will be loaded here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelSubmit">
                    <i class="bi bi-x-lg"></i>
                    Cancelar
                </button>
                <button class="btn btn-success" id="confirmSubmit">
                    <i class="bi bi-check-circle"></i>
                    Finalizar Prueba
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script src="../Elementos/js/config.js"></script>
    <script src="../Elementos/js/tomar-prueba.js"></script>
    <script src="../Elementos/js/music-player.js"></script>
</body>

</html>